---
title: "Assignment 4"
author: "Kazia Mermel"
date: "5/24/2020"
output: pdf_document
---

Overall questions:
  2c
    Do we care about the discount rate for 2c?
    Are we comparing pv or utility?


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

# Variables:
# temperature at time t
# t = time
# t_diff = T = temperature at time 100 (given)

 #overall value for T

# Givens & Vectors:

t_vector <- seq(0,200, by = 1)

```


Structure for Functions 1 - 5 is next.

```{r}
# Function 1 - Temperature(t)

temp <- function(t, t_diff){
  out = pmin((t*t_diff)/100,t_diff)
  return(out)
}


# Function 2 - Retention (t)

retention <- function(t, t_diff, B){
  out = exp(-B * (temp(t, t_diff))^2)
  return(out)
}


# Function 3 - Consumption (t)
consumption <- function(t, t_diff, B, g){
  out = retention(t, t_diff, B) * exp(g*t)
  return(out)
}


# Function 4 - Utility (C)

utility <- function(C, n){
  out = (C^(1-n))/(1-n)
  return(out)
}


# Function 5 - Discount Rate (Ramsey Rule)

r <- function(d, n, g){
  out = (d + n*g)
  return(out)
}


```


*Data Frames for Plots*

Givens for Part 1

t_diff = 5 # T
B = .05
g = .01
n = .5
d = .005   # delta

*T = 0*

```{r}
# T = 0

# Temperature df

temp_df_T_0 <- data.frame(t = t_vector) %>% 
  mutate(temp = temp(t_vector,
                     t_diff = 0))
  

# Retention df

retent_df_T_0 <- data.frame(t = t_vector) %>% 
  mutate(retent = retention(t_vector,
                            t_diff = 0,
                            B = .05)) 
# Consumption df

consum_df_T_0 <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 0,
                              B = 0.05,
                              g = 0.01))

# Utility df

C_0 <- consum_df_T_0$consum

utility_df_T_0 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_0) %>% 
  mutate(utility = utility(C = C_0,
                           n = .5))
  
```

*T = 2*

```{r}
# T = 2

# Temperature df

temp_df_T_2 <- data.frame(t = t_vector) %>% 
  mutate(temp = temp(t_vector,
                     t_diff = 2)) 

# Retention df

retent_df_T_2 <- data.frame(t = t_vector) %>% 
  mutate(retent = retention(t_vector,
                            t_diff = 2,
                            B = .05)) 
# Consumption df

consum_df_T_2 <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 2,
                              B = 0.05,
                              g = 0.01))

# Utility df

C_2 <- consum_df_T_2$consum

utility_df_T_2 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_2) %>% 
  mutate(utility = utility(C = C_2,
                           n = .5))
  
```

*T = 8*
```{r}
# T = 8

# Temperature df

temp_df_T_8 <- data.frame(t = t_vector) %>% 
  mutate(temp = temp(t_vector,
                     t_diff = 8))

# Retention df

retent_df_T_8 <- data.frame(t = t_vector) %>% 
  mutate(retent = retention(t_vector,
                            t_diff = 8,
                            B = .05)) 
# Consumption df

consum_df_T_8 <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 8,
                              B = 0.05,
                              g = 0.01))

# Utility df

C_8 <- consum_df_T_8$consum

utility_df_T_8 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_8) %>% 
  mutate(utility = utility(C = C_8,
                           n = .5))
  
```

Question 1
```{r}
# a
# plot temperature over time
# scenario 1: no climate change


# scenario 2: moderate climate change

# scenario 3: major climate change
```


Plot 1a
```{r}
ggplot () +
  geom_line(data = temp_df_T_0,
            aes( x = t,
                 y = temp),
            size = 1.5,
            color = "blue") +
  geom_line(data = temp_df_T_2,
            aes( x = t,
                 y = temp),
            size = 1.5,
            color = "green") +
  geom_line(data = temp_df_T_8,
            aes( x = t,
                 y = temp),
            size = 1.5,
            color = "red") +
  labs(title = "Predictions of Temperature Increase Due to Climate Change" ,
       x = "Time (years)",
       y = "Temperature Increase Relative to Present (degrees)",
       caption = "Figure 1") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0),
        axis.title.y = element_text(size = 10))
             
```

Plot 1b
```{r}
ggplot () +
  geom_line(data = consum_df_T_0,
             aes( x = t,
                  y = consum),
             size = 1.5,
             color = "blue") +
  geom_line(data = consum_df_T_2,
             aes( x = t,
                  y = consum),
             size = 1.5,
             color = "green") +
  geom_line(data = consum_df_T_8,
             aes( x = t,
                  y = consum),
             size = 1.5,
             color = "red") +
  labs(title = "" ,
       x = "Time (years)",
       y = "",
       caption = "Figure 2") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0),
        axis.title.y = element_text(size = 10))
```



```{r}
ggplot () +
  geom_line(data = utility_df_T_0,
            aes( x = t,
                  y = utility),
            size = 1.5,
            color = "blue") +
  geom_line(data = utility_df_T_2,
            aes( x = t,
                  y = utility),
            size = 1.5,
            color = "green") +
  geom_line(data = utility_df_T_8,
            aes( x = t,
                  y = utility),
            size = 1.5,
            color = "red") +
labs(title = "" ,
       x = "Time (years)",
       y = "",
       caption = "Figure 3") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.caption = element_text(hjust = 0),
        axis.title.y = element_text(size = 10))
```

**Question 2a**

*T = 4.4*
```{r}
# T = 4.4
# Maintained givens from plot 1

# Temperature df

temp_df_T_4_4 <- data.frame(t = t_vector) %>% 
  mutate(temp = temp(t_vector,
                     t_diff = 4.4))

# Retention df

retent_df_T_4_4 <- data.frame(t = t_vector) %>% 
  mutate(retent = retention(t_vector,
                            t_diff = 4.4,
                            B = .05)) 
# Consumption df

consum_df_T_4_4 <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 4.4,
                              B = 0.05,
                              g = 0.01))

# Utility df

C_4_4 <- consum_df_T_4_4$consum

utility_df_T_4_4 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_4_4) %>% 
  mutate(utility = utility(C = C_4_4,
                           n = .5))
  
```


Present value discounted over 200 years w/ & w/o climate change

```{r}
# Present value discounted over 200 years w/ climate change

# discount rate
r_given <- r(.005, .5, .01)

# Value calculation
pv_df_4_4 <- data.frame(t = t_vector) %>% 
  mutate(pv_4_4 = (utility_df_T_4_4$utility)/(1 + r_given)^(t_vector))

pv_4_4 = sum(pv_df_4_4$pv_4_4)

# Present value discounted over 200 years w/o climate change

# Value calculation
pv_df_0 <- data.frame(t = t_vector) %>% 
  mutate(pv_0 = (utility_df_T_0$utility)/(1 + r_given)^(t_vector))

pv_0 = sum(pv_df_0$pv_0)
```

Percentage Loss (L)
```{r}

L_cc <- abs(pv_0-pv_4_4)/pv_0 * 100


```



**Question 2b**

Sensitivity of T
```{r}
# Present value discounted over 200 years w/ climate change
# T = 4.4 + .44 = 4.84

# Temperature df

temp_df_T_4_84 <- data.frame(t = t_vector) %>% 
  mutate(temp = temp(t_vector,
                     t_diff = 4.84))

# Retention df

retent_df_T_4_84 <- data.frame(t = t_vector) %>% 
  mutate(retent = retention(t_vector,
                            t_diff = 4.84,
                            B = .05)) 
# Consumption df

consum_df_T_4_84 <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 4.84,
                              B = 0.05,
                              g = 0.01))

# Utility df

C_4_84 <- consum_df_T_4_84$consum

utility_df_T_4_84 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_4_84) %>% 
  mutate(utility = utility(C = C_4_84,
                           n = .5))

# Value calculation
pv_df_4_84 <- data.frame(t = t_vector) %>% 
  mutate(pv_4_84 = (utility_df_T_4_84$utility)/(1 + r_given)^(t_vector))

pv_4_84 = sum(pv_df_4_84$pv_4_84)

```

Percentage Loss (L) for T Sensitivy Analysis
```{r}

L_T_sens <- abs(pv_0-pv_4_84)/pv_0 * 100


```


Sensitivity of B
```{r}
# T = 4.4 ************************************************************************************************
# B = .055

# Retention df

retent_df_B_055 <- data.frame(t = t_vector) %>% 
  mutate(retent = retention(t_vector,
                            t_diff = 4.4,
                            B = .055)) 
# Consumption df

consum_df_B_055 <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 4.4,
                              B = 0.055,
                              g = 0.01))

# Utility df

C_B_055 <- consum_df_B_055$consum

utility_df_B_055 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_B_055) %>% 
  mutate(utility = utility(C = C_B_055,
                           n = .5))

# Value calculation
pv_df_B_055 <- data.frame(t = t_vector) %>% 
  mutate(pv_B_055 = (utility_df_B_055$utility)/(1 + r_given)^(t_vector))

pv_B_055 = sum(pv_df_B_055$pv_B_055)

# T = 0 *************************************************************************************************
# B = .055

# Retention df

retent_df_T_0_B <- data.frame(t = t_vector) %>% 
  mutate(retent = retention(t_vector,
                            t_diff = 0,
                            B = .055)) 
# Consumption df

consum_df_T_0_B <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 0,
                              B = 0.055,
                              g = 0.01))

# Utility df

C_0_B <- consum_df_T_0_B$consum

utility_df_T_0_B <- data.frame(t = t_vector) %>% 
  mutate(consum = C_0_B) %>% 
  mutate(utility = utility(C = C_0_B,
                           n = .5))

# Present value discounted over 200 years w/o climate change
# Value calculation
pv_df_0_B <- data.frame(t = t_vector) %>% 
  mutate(pv_0_B = (utility_df_T_0_B$utility)/(1 + r_given)^(t_vector))

pv_0_B = sum(pv_df_0_B$pv_0_B)
```


Percentage Loss (L) for B Sensitivy Analysis
```{r}

L_B_sens <- abs(pv_0_B-pv_B_055)/pv_0_B * 100


```


Sensitivity of g
```{r}
# T = 4.4 ***********************************************************************
# g = .01 + .001 = .011

# Consumption df

consum_df_g_01 <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 4.4,
                              B = 0.05,
                              g = 0.011))

# Utility df

C_g_01 <- consum_df_g_01$consum

utility_df_g_01 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_g_01) %>% 
  mutate(utility = utility(C = C_g_01,
                           n = .5))

#T = 0****************************************************************************
# g = .01 + .001 = .011
# Temperature df

# Consumption df

consum_df_T_0_g <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 0,
                              B = 0.05,
                              g = 0.011))

# Utility df

C_0_g <- consum_df_T_0_g$consum

utility_df_T_0_g <- data.frame(t = t_vector) %>% 
  mutate(consum = C_0_g) %>% 
  mutate(utility = utility(C = C_0_g,
                           n = .5))


# discount rate
r_g <- r(.005, .5, .011) 

# Value calculation
pv_df_g_01 <- data.frame(t = t_vector) %>% 
  mutate(pv_g_01 = (utility_df_g_01$utility)/(1 + r_g)^(t_vector))

pv_g_01 = sum(pv_df_g_01$pv_g_01)

# Present value discounted over 200 years w/o climate change

# Value calculation
pv_df_0_g <- data.frame(t = t_vector) %>% 
  mutate(pv_0_g = (utility_df_T_0_g$utility)/(1 + r_g)^(t_vector))

pv_0_g = sum(pv_df_0_g$pv_0_g)
```


Percentage Loss (L) for g Sensitivy Analysis
```{r}

L_g_sens <- abs(pv_0_g-pv_g_01)/pv_0_g * 100


```


Sensitivity of n
```{r}
# T = 4.4************************************************************************
# n = 0.5 +.05 = 0.55


# Utility df
# C_4_4 is not affected by N so it is ok to leave as is

utility_df_n_55 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_4_4) %>% 
  mutate(utility = utility(C = C_4_4,
                           n = .55))

# T = 0 ************************************************************************
# n = 0.5 +.05 = 0.55

# Utility df
# Leave consum = C_0 because it is unaffected by n

utility_df_T_0_n <- data.frame(t = t_vector) %>% 
  mutate(consum = C_0) %>% 
  mutate(utility = utility(C = C_0,
                           n = .55))

# discount rate
r_n <- r(.005, .55, .01) 

# Value calculation
pv_df_n_55 <- data.frame(t = t_vector) %>% 
  mutate(pv_n_55 = (utility_df_n_55$utility)/(1 + r_n)^(t_vector))

pv_n_55 = sum(pv_df_n_55$pv_n_55)

# Present value discounted over 200 years w/o climate change

# Value calculation
pv_df_0_n <- data.frame(t = t_vector) %>% 
  mutate(pv_0_n = (utility_df_T_0_n$utility)/(1 + r_n)^(t_vector))

pv_0_n = sum(pv_df_0_n$pv_0_n)
```


Percentage Loss (L) for n Sensitivy Analysis
```{r}

L_n_sens <- abs(pv_0_n-pv_n_55)/pv_0_n * 100


```


**Question 2c**

Givens:
Vnot = p_4_4
Vsubt = utility(C) for T = 0 = utility_df_T_0
d = 0.005
n = 0.5
g = 0.01
B = 0.05

```{r}


pv_with_discount_T_0 <- data.frame(t = t_vector)  %>% 
  mutate(pv_with_discount =  (utility(C = C_0,n = .5)) * (1 + r_given)^(t_vector))


n = 0.5

theta = (pv_4_4 /(sum(pv_with_discount_T_0)))^ (1 / (1-n))
```




# Consumption df

consum_df_T_0 <- data.frame(t = t_vector) %>% 
  mutate(consum = consumption(t_vector,
                              t_diff = 0,
                              B = 0.05,
                              g = 0.01))

# Utility df

C_0 <- consum_df_T_0$consum

utility_df_T_0 <- data.frame(t = t_vector) %>% 
  mutate(consum = C_0) %>% 
  mutate(utility = utility(C = C_0,
                           n = .5))





 Function 1 - Temperature(t)

temp <- function(t, t_diff){
  out = pmin((t*t_diff)/100,t_diff)
  return(out)
}


# Function 2 - Retention (t)

retention <- function(t, t_diff, B){
  out = exp(-B * (temp(t, t_diff))^2)
  return(out)
}


# Function 3 - Consumption (t)
consumption <- function(t, t_diff, B, g){
  out = retention(t, t_diff, B) * exp(g*t)
  return(out)
}


# Function 4 - Utility (C)

utility <- function(C, n){
  out = (C^(1-n))/(1-n)
  return(out)
}


# Function 5 - Discount Rate (Ramsey Rule)

r <- function(d, n, g){
  out = (d + n*g)
  return(out)
}








